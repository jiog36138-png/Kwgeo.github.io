<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´‘ìš´ëŒ€í•™êµ ë§›ì§‘ ì¶”ì²œ - KW EATS API ë¼ˆëŒ€</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* [Design System] Modern & Clean */
        :root {
            --primary-color: #8a1525;  /* ê´‘ìš´ëŒ€ ë²„ê±´ë”” */
            --primary-hover: #6b101d;
            --bg-color: #f0f2f5;       /* ë°°ê²½ìƒ‰: ë¼ì´íŠ¸ ê·¸ë ˆì´ */
            --card-bg: #ffffff;        /* ì¹´ë“œ ë°°ê²½: í°ìƒ‰ */
            --text-main: #212529;
            --text-sub: #6c757d;
            --border-color: #dee2e6;
            --shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            --radius: 10px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 30px 15px;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .app-container {
            background: var(--card-bg);
            width: 100%;
            max-width: 500px; /* ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ìµœì í™” */
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        /* ìƒë‹¨ í—¤ë” (Modern Sports Style) */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem;
            text-align: center;
            border-bottom: 5px solid #ffc107; /* ê°•ì¡° ë¼ì¸ */
        }
        .header h1 {
            font-size: 1.4rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* ì½˜í…ì¸  ì˜ì—­ */
        .content {
            padding: 2.5rem;
        }
        
        .page-title {
            text-align: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 2.5rem;
        }

        /* í¼ ê·¸ë£¹ ê³µí†µ */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.7rem;
            color: var(--text-main);
            font-size: 0.95rem;
        }

        /* Slider */
        .range-container { position: relative; padding: 0 5px; }
        input[type=range] { width: 100%; height: 8px; background: #ddd; border-radius: 4px; outline: none; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%; background: var(--primary-color); cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .hunger-value { text-align: right; font-size: 0.9rem; color: var(--text-sub); margin-top: 5px; }

        /* Chips UI */
        .chip-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip-input { display: none; }
        .chip-label {
            padding: 8px 15px; background-color: #fff; border: 1px solid var(--border-color); border-radius: 20px;
            font-size: 0.9rem; color: var(--text-sub); cursor: pointer; transition: all 0.2s ease;
        }
        .chip-input:checked + .chip-label {
            background-color: var(--primary-color); color: white; border-color: var(--primary-color); font-weight: 500;
            box-shadow: 0 2px 4px rgba(138, 21, 37, 0.3);
        }
        .chip-label:hover { border-color: var(--primary-color); }

        /* Input Field */
        .input-group { position: relative; }
        .input-field {
            width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; outline: none; transition: border-color 0.3s;
        }
        .input-field:focus { border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(138, 21, 37, 0.2); }
        .unit { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-sub); font-size: 0.9rem; }

        /* ê¸°íƒ€ ìš”êµ¬ì‚¬í•­ (Textarea) */
        textarea.input-field {
            resize: vertical; min-height: 80px;
        }

        /* ë²„íŠ¼ */
        .btn-submit {
            width: 100%; padding: 18px; background-color: var(--primary-color); color: white; border: none;
            border-radius: 8px; font-size: 1.2rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s, transform 0.1s; margin-top: 2rem;
            box-shadow: 0 4px 10px rgba(138, 21, 37, 0.4);
        }
        .btn-submit:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; box-shadow: none; }

        /* ê²°ê³¼/ìƒíƒœ ë©”ì‹œì§€ */
        #statusMessage { margin-top: 20px; text-align: center; font-size: 1rem; min-height: 20px; font-weight: 500;}
        
        /* ê²°ê³¼ ì¹´ë“œ ë””ìì¸ */
        #resultsContainer { margin-top: 30px; }
        .result-card {
            background: var(--card-bg); border: 1px solid var(--border-color); border-left: 5px solid var(--primary-color); border-radius: 8px; 
            padding: 20px; margin-top: 15px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); transition: all 0.2s;
        }
        .result-card h3 {
            color: var(--primary-color); margin-bottom: 5px; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center;
        }
        .result-card .rating { font-weight: 700; color: #ffc107; font-size: 1rem; }
        .result-card p { font-size: 0.9rem; color: var(--text-sub); margin-bottom: 6px; line-height: 1.4; }
        
        /* ì§€ë„ ë²„íŠ¼ ê·¸ë£¹ */
        .map-buttons { display: flex; gap: 8px; margin-top: 15px; }
        .map-btn {
            flex: 1; padding: 10px; font-size: 0.9rem; border: 1px solid #333; border-radius: 6px; background: #fff; 
            color: #333; text-decoration: none; text-align: center; font-weight: 500; transition: all 0.2s;
        }
        .map-btn.naver { border-color: #03C75A; color: #03C75A; }
        .map-btn.naver:hover { background: #03C75A; color: white; }
        .map-btn.google { border-color: #4285F4; color: #4285F4; }
        .map-btn.google:hover { background: #4285F4; color: white; }
    </style>
</head>
<body>

    <div class="app-container">
        <header class="header">
            <h1>KWANGWOON EATS</h1>
        </header>

        <div class="content">
            <h2 class="page-title">AI ë§›ì§‘ ì¶”ì²œ (API ë¼ˆëŒ€)</h2>

            <form id="recommendForm" onsubmit="event.preventDefault(); register();">
                
                <div class="form-group">
                    <label class="form-label">ë°°ê³ í”” ì •ë„</label>
                    <div class="range-container">
                        <input type="range" id="hunger" min="0" max="100" value="50" oninput="updateHunger(this.value)">
                    </div>
                    <div class="hunger-value">í˜„ì¬ ìƒíƒœ: <span id="hungerText">50</span>%</div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì‹ì‚¬ ì‹œê°„ëŒ€</label>
                    <div class="chip-group">
                        <input type="radio" name="mealTime" id="time1" value="ì•„ì¹¨" class="chip-input">
                        <label for="time1" class="chip-label">ì•„ì¹¨</label>

                        <input type="radio" name="mealTime" id="time2" value="ì ì‹¬" class="chip-input" checked>
                        <label for="time2" class="chip-label">ì ì‹¬</label>

                        <input type="radio" name="mealTime" id="time3" value="ì €ë…" class="chip-input">
                        <label for="time3" class="chip-label">ì €ë…</label>

                        <input type="radio" name="mealTime" id="time4" value="ì•¼ê°„" class="chip-input">
                        <label for="time4" class="chip-label">ì•¼ê°„</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì›í•˜ëŠ” ìŒì‹ ì¢…ë¥˜</label>
                    <div class="chip-group">
                        <input type="radio" name="cuisine" id="food1" value="í•œì‹" class="chip-input" checked>
                        <label for="food1" class="chip-label">í•œì‹</label>

                        <input type="radio" name="cuisine" id="food2" value="ì¤‘ì‹" class="chip-input">
                        <label for="food2" class="chip-label">ì¤‘ì‹</label>

                        <input type="radio" name="cuisine" id="food3" value="ì–‘ì‹" class="chip-input">
                        <label for="food3" class="chip-label">ì–‘ì‹</label>

                        <input type="radio" name="cuisine" id="food4" value="ì¼ì‹" class="chip-input">
                        <label for="food4" class="chip-label">ì¼ì‹</label>

                        <input type="radio" name="cuisine" id="food5" value="ë””ì €íŠ¸" class="chip-input">
                        <label for="food5" class="chip-label">ë””ì €íŠ¸</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì˜ˆì‚° (1ì¸ ê¸°ì¤€)</label>
                    <div class="input-group">
                        <input type="number" id="price" class="input-field" value="10000" placeholder="ì˜ˆ: 10000" step="1000">
                        <span class="unit">ì›</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">í•™êµì—ì„œì˜ ë„ë³´ ê±°ë¦¬</label>
                    <div class="chip-group">
                        <input type="radio" name="distance" id="dist1" value="5" class="chip-input" checked>
                        <label for="dist1" class="chip-label">5ë¶„ ì´ë‚´</label>

                        <input type="radio" name="distance" id="dist2" value="7" class="chip-input">
                        <label for="dist2" class="chip-label">7ë¶„ ì´ë‚´</label>

                        <input type="radio" name="distance" id="dist3" value="10" class="chip-input">
                        <label for="dist3" class="chip-label">10ë¶„ ì´ë‚´</label>
                        
                        <input type="radio" name="distance" id="dist4" value="20" class="chip-input">
                        <label for="dist4" class="chip-label">20ë¶„ ì´ë‚´</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes" class="form-label">ê¸°íƒ€ ìš”êµ¬ì‚¬í•­ (ì„ íƒ)</label>
                    <textarea id="notes" class="input-field" placeholder="ì˜ˆ: ë§¤ìš´ ìŒì‹ ì„ í˜¸, ì¡°ìš©í–ˆìœ¼ë©´ ì¢‹ê² ìŒ"></textarea>
                </div>


                <button type="submit" class="btn-submit">AI ì¶”ì²œ ë§›ì§‘ ì°¾ê¸°</button>
            </form>

            <div id="statusMessage"></div>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        // [í•µì‹¬ ìš”êµ¬ì‚¬í•­ 1] API ì„œë²„ ì£¼ì†Œ ìƒìˆ˜
        // ë‚˜ì¤‘ì— FastAPI ì„œë²„ URLë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
        const SERVER_URL = 'https://690c5390-4fcc-422d-b5f2-54fc010c64fa-00-bfmkaky2tk2p.picard.replit.dev'; 
        // Replit ë“± ì›ê²© ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° 'https://[ë‹¹ì‹ ì˜-replit-ì£¼ì†Œ].repl.co' ë“±ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

        // UI í•¨ìˆ˜
        function updateHunger(val) {
            document.getElementById('hungerText').innerText = val;
        }

        function showStatus(msg, isError = false) {
            const el = document.getElementById('statusMessage');
            el.innerText = msg;
            el.style.color = isError ? '#d32f2f' : '#2e7d32'; 
        }

        // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ ë°ì´í„° (ì„œë²„ ì‘ë‹µì„ ê°€ì •)
        const DUMMY_RESPONSE = [
            { name: "ê´‘ìš´ë¶„ì‹", menu: "ë–¡ë³¶ì´, ê¹€ë°¥", budget: 7000, distance: 5, rating: 4.3, mapQuery: "ê´‘ìš´ëŒ€ ê´‘ìš´ë¶„ì‹" },
            { name: "í•™ì‹ë‹¹", menu: "ì˜¤ëŠ˜ì˜ ë©”ë‰´", budget: 5500, distance: 2, rating: 3.8, mapQuery: "ê´‘ìš´ëŒ€ í•™ì‹ë‹¹" }
        ];


        /**
         * [í•µì‹¬ ìš”êµ¬ì‚¬í•­ 2] API í†µì‹  ë¡œì§ í•¨ìˆ˜
         * ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©°, ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡ì„ ì‹œë„í•©ë‹ˆë‹¤.
         */
        async function register() {
            const submitButton = document.querySelector('.btn-submit');
            const resultsContainer = document.getElementById('resultsContainer');
            
            // 1. ì…ë ¥ê°’ ìˆ˜ì§‘ ë° ê°ì²´ ìƒì„±
            const priceVal = document.getElementById('price').value;
            const mealTimeVal = document.querySelector('input[name="mealTime"]:checked')?.value;
            const cuisineVal = document.querySelector('input[name="cuisine"]:checked')?.value;
            const distanceVal = document.querySelector('input[name="distance"]:checked')?.value;
            const hungerVal = document.getElementById('hunger').value;
            const notesVal = document.getElementById('notes').value;

            // âš ï¸ í•„ìˆ˜ ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬ (ì˜ˆì‚°)
            if (!priceVal || parseInt(priceVal) <= 0) {
                showStatus("âš ï¸ ì˜ˆì‚°ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
                document.getElementById('price').focus();
                return;
            }

            const requestData = {
                hunger: parseInt(hungerVal),
                mealTime: mealTimeVal,
                cuisine: cuisineVal,
                price: parseInt(priceVal),
                distance: parseInt(distanceVal),
                notes: notesVal
            };

            // 2. UI ì´ˆê¸°í™” ë° ë¡œë”© ì‹œì‘
            resultsContainer.innerHTML = ''; 
            submitButton.disabled = true;
            showStatus("ğŸš€ AI ì„œë²„(FastAPI)ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ì¤‘...");

            try {
                // [CORE LOGIC] ì„œë²„ í†µì‹  (method: 'POST')
                const response = await fetch(`${SERVER_URL}/recommend`, {
                    method: 'POST', // í†µì‹  ë°©ì‹
                    headers: { 
                        'Content-Type': 'application/json' 
                    },
                    // JSON ë°ì´í„° ì „ì†¡
                    body: JSON.stringify(requestData), 
                });

                // ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
                const result = await response.json();

                if (response.ok) {
                    // ì„œë²„ ì‘ë‹µì´ ì„±ê³µ (200 OK)ì¼ ê²½ìš°
                    handleServerResponse(result);
                } else {
                    // 4xx, 5xx ì—ëŸ¬ì¸ ê²½ìš°
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${result.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                // Fetch ìì²´ ì‹¤íŒ¨ (SERVER_URL ë¯¸ì‘ë™, CORS ë¬¸ì œ ë“±)
                showStatus(`âŒ API í†µì‹  ì‹¤íŒ¨ (URL í™•ì¸ í•„ìš”): ${error.message}`, true);
                
                // í†µì‹  ì‹¤íŒ¨ ì‹œ ë”ë¯¸ ë°ì´í„°ë¡œ ëŒ€ì²´ í‘œì‹œ (ì„ íƒ ì‚¬í•­, í…ŒìŠ¤íŠ¸ìš©)
                // handleServerResponse({ recommendations: DUMMY_RESPONSE, message: "ë”ë¯¸ ë°ì´í„° í‘œì‹œ (í†µì‹  ì‹¤íŒ¨)" });
            } finally {
                // 4. ë²„íŠ¼ í™œì„±í™”
                submitButton.disabled = false;
            }
        }

        /**
         * ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
         */
        function handleServerResponse(data) {
            const resultsContainer = document.getElementById('resultsContainer');
            const recommendations = data.recommendations || []; // ì„œë²„ ì‘ë‹µì—ì„œ ì¶”ì²œ ëª©ë¡ì„ ê°€ì ¸ì˜´

            if (recommendations.length > 0) {
                showStatus(`âœ… ${recommendations.length}ê°œì˜ ë§›ì§‘ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!`);
                
                recommendations.forEach(r => {
                    const card = document.createElement('div');
                    card.className = 'result-card';
                    
                    // ì§€ë„ ê²€ìƒ‰ URL ìƒì„±
                    const query = r.mapQuery || `ê´‘ìš´ëŒ€ ${r.name}`; // ì„œë²„ì—ì„œ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ì¤„ ìˆ˜ë„ ìˆìŒ
                    const naverMapUrl = `https://map.naver.com/v5/search/${encodeURIComponent(query)}`;
                    const googleMapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;

                    // toLocaleString()ì€ ìˆ«ì í¬ë§·íŒ…ì„ ìœ„í•´ ì‚¬ìš©
                    const budgetText = r.budget ? r.budget.toLocaleString() + 'ì›' : 'ì •ë³´ ì—†ìŒ';

                    card.innerHTML = `
                        <h3>${r.name} <span class="rating">â˜… ${r.rating || 'N/A'}</span></h3>
                        <p>ğŸ½ï¸ ì‹œê·¸ë‹ˆì²˜ ë©”ë‰´: <strong>${r.menu || 'ì •ë³´ ì—†ìŒ'}</strong></p>
                        <p>ğŸ’° í‰ê·  ì˜ˆì‚°: <strong>${budgetText}</strong></p>
                        <p>ğŸš¶ ë„ë³´ ê±°ë¦¬: <strong>ì•½ ${r.distance || 'N/A'}ë¶„</strong></p>
                        <div class="map-buttons">
                            <a href="${naverMapUrl}" target="_blank" class="map-btn naver">ë„¤ì´ë²„ ì§€ë„</a>
                            <a href="${googleMapUrl}" target="_blank" class="map-btn google">êµ¬ê¸€ ì§€ë„</a>
                        </div>
                    `;
                    resultsContainer.appendChild(card);
                });

                // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } else {
                showStatus("ì¡°ê±´ì— ë§ëŠ” ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¢", true);
                resultsContainer.innerHTML = `
                    <div style="text-align:center; padding: 20px; color: var(--text-sub);">
                        <p>ì„ íƒí•˜ì‹  ì¡°ê±´ì˜ ì‹ë‹¹ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”.</p>
                        <p>ì˜ˆì‚°ì„ ì¡°ê¸ˆ ì˜¬ë¦¬ê±°ë‚˜, ê±°ë¦¬ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”!</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

